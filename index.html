<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Forest Fire Detection - SmartVision AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background-color: #333;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
        }

        .image-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .image-box {
            background-color: #262626;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
        }

        .image-box h3 {
            color: #fff;
            margin-bottom: 10px;
            text-align: center;
        }

        .image-display {
            width: 100%;
            height: 400px;
            background-color: #1a1a1a;
            border: 2px dashed #444;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .image-display img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .controls {
            background-color: #262626;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .btn {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-load { background-color: #4d94ff; }
        .btn-enhance { background-color: #33cc66; }
        .btn-detect { background-color: #ff6644; }
        .btn-train { background-color: #9966ff; }
        .btn-save { background-color: #66b3ff; }
        .btn-reset { background-color: #cc5252; }
        .btn-predict { background-color: #9966ff; }

        .param-row {
            display: grid;
            grid-template-columns: 150px 1fr 150px 100px;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .param-label {
            color: #ccc;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        input[type="number"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #1a1a1a;
            color: #fff;
            width: 100%;
        }

        .status-bar {
            background-color: #1a1a1a;
            padding: 15px 20px;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            min-height: 50px;
            white-space: pre-wrap;
        }

        .loader {
            display: none;
            border: 4px solid #333;
            border-top: 4px solid #ffd700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        input[type="file"] {
            display: none;
        }

        @media (max-width: 768px) {
            .image-container {
                grid-template-columns: 1fr;
            }
            .param-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• FOREST FIRE DETECTION SYSTEM</h1>
        </div>

        <div class="image-container">
            <div class="image-box">
                <h3>Original Image</h3>
                <div class="image-display" id="originalImage">
                    <span style="color: #666;">No image loaded</span>
                </div>
            </div>
            <div class="image-box">
                <h3>Detection Result</h3>
                <div class="image-display" id="resultImage">
                    <span style="color: #666;">No result yet</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="button-row">
                <input type="file" id="fileInput" accept="image/*">
                <button class="btn btn-load" onclick="loadImage()">üìÇ Load Image</button>
                <button class="btn btn-enhance" onclick="enhanceImage()" id="btnEnhance" disabled>‚ú® Enhance</button>
                <button class="btn btn-detect" onclick="detectFire()" id="btnDetect" disabled>üî• Detect Fire</button>
                <button class="btn btn-predict" onclick="predictML()" id="btnPredict" disabled>üéØ Predict with ML</button>
                <button class="btn btn-save" onclick="saveResult()" id="btnSave" disabled>üíæ Save Result</button>
                <button class="btn btn-reset" onclick="resetAll()">üîÑ Reset</button>
            </div>

            <div class="param-row">
                <label class="param-label">Sensitivity</label>
                <input type="range" id="sensitivity" min="0.1" max="1" step="0.1" value="0.5" oninput="updateSensitivity()">
                <label class="param-label">Min Fire Area</label>
                <input type="number" id="minArea" value="300" min="10" max="5000">
            </div>
        </div>

        <div class="loader" id="loader"></div>

        <div class="status-bar" id="statusBar">
            Status: Ready ‚Äî Load an image.
        </div>
    </div>

    <script>
        let currentImage = null;
        let lastMetrics = null;
        let resultImage = null;

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('/metrics');
                const data = await response.json();
                if (data.error) {
                    console.warn('Metrics not available:', data.error);
                } else {
                    lastMetrics = data;
                }
            } catch (e) {
                console.warn('Failed to load metrics:', e);
            }
            document.getElementById('btnPredict').disabled = false;
        });

        function loadImage() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                currentImage = event.target.result;
                displayImage('originalImage', currentImage);
                updateStatus(`‚úÖ Loaded ${file.name} | ${(file.size/1024).toFixed(2)} KB`);
                enableButtons();
            };
            reader.readAsDataURL(file);
        });

        function displayImage(elementId, src) {
            const container = document.getElementById(elementId);
            container.innerHTML = `<img src="${src}" alt="Image">`;
        }

        function enableButtons() {
            document.getElementById('btnEnhance').disabled = false;
            document.getElementById('btnDetect').disabled = false;
        }

        async function enhanceImage() {
            if (!currentImage) {
                updateStatus('‚ö†Ô∏è Load image first.');
                return;
            }

            showLoader(true);
            updateStatus('‚ú® Enhancing image...');

            try {
                const response = await fetch('/enhance', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({image: currentImage})
                });

                const data = await response.json();
                if (data.success) {
                    currentImage = data.enhanced_image;
                    displayImage('originalImage', currentImage);
                    updateStatus('‚ú® Enhanced with adaptive histogram equalization.');
                } else {
                    updateStatus('‚ùå Enhancement failed: ' + data.error);
                }
            } catch (error) {
                updateStatus('‚ùå Error: ' + error.message);
            }

            showLoader(false);
        }

        async function detectFire() {
            if (!currentImage) {
                updateStatus('‚ö†Ô∏è Load image first.');
                return;
            }

            showLoader(true);
            updateStatus('üî• Detecting fire...');

            const sensitivity = document.getElementById('sensitivity').value;
            const minArea = document.getElementById('minArea').value;

            try {
                const response = await fetch('/detect', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        image: currentImage,
                        sensitivity: parseFloat(sensitivity),
                        min_area: parseInt(minArea)
                    })
                });

                const data = await response.json();
                if (data.success) {
                    resultImage = data.result_image;
                    displayImage('resultImage', resultImage);
                    updateStatus(`üî• Detection done. ${data.num_regions} regions | ${data.fire_percent.toFixed(2)}% fire area.`);
                    document.getElementById('btnSave').disabled = false;
                } else {
                    updateStatus('‚ùå Detection failed: ' + data.error);
                }
            } catch (error) {
                updateStatus('‚ùå Error: ' + error.message);
            }

            showLoader(false);
        }

        async function trainModel() {
            showLoader(true);
            updateStatus('üß† Training ML models... please wait.');

            try {
                const response = await fetch('/train', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                const data = await response.json();
                if (data.success) {
                    updateStatus(data.message);
                    document.getElementById('btnPredict').disabled = false;
                    lastMetrics = data.metrics;
                } else {
                    updateStatus('‚ùå Training failed: ' + data.error);
                }
            } catch (error) {
                updateStatus('‚ùå Error: ' + error.message);
            }

            showLoader(false);
        }

        async function predictML() 
        {
            if (!currentImage) 
            {
                updateStatus('‚ö†Ô∏è Load image first.');
            return;
            }

            showLoader(true);
            updateStatus('üéØ Running ML prediction...');

            try {
                const response = await fetch('/predict_ml', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({image: currentImage})
                });

                const data = await response.json();
                                if (data.success) {
                    let output = `üéØ ML Prediction: ${data.prediction} (Confidence: ${(data.confidence * 100).toFixed(1)}%)`;
                    
                    if (lastMetrics) {
                        const svm = lastMetrics.svm;
                        const rf = lastMetrics.rf;
                        output += `
                            <div style="margin-top: 12px; background: #1e1e1e; padding: 14px; border-radius: 8px; border: 1px solid #444; font-size: 13px;">
                                <table style="width: 100%; border-collapse: collapse; text-align: center;">
                                    <thead>
                                        <tr style="background: #2d2d2d; height: 36px;">
                                            <th style="padding: 0 8px; font-weight: 600; color: #ffd700;">Metric</th>
                                            <th style="padding: 0 8px; font-weight: 600;">SVM</th>
                                            <th style="padding: 0 8px; font-weight: 600; color: #66b3ff;">RF</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="height: 34px; border-bottom: 1px solid #333;">
                                            <td style="padding: 4px 8px;">Accuracy</td>
                                            <td style="padding: 4px 8px;">${svm.acc.toFixed(2)}%</td>
                                            <td style="padding: 4px 8px; color: #66b3ff;">${rf.acc.toFixed(2)}%</td>
                                        </tr>
                                        <tr style="height: 34px; background: #252525; border-bottom: 1px solid #333;">
                                            <td style="padding: 4px 8px;">Precision</td>
                                            <td style="padding: 4px 8px;">${svm.prec.toFixed(2)}</td>
                                            <td style="padding: 4px 8px; color: #66b3ff;">${rf.prec.toFixed(2)}</td>
                                        </tr>
                                        <tr style="height: 34px; border-bottom: 1px solid #333;">
                                            <td style="padding: 4px 8px;">Recall</td>
                                            <td style="padding: 4px 8px;">${svm.rec.toFixed(2)}</td>
                                            <td style="padding: 4px 8px; color: #66b3ff;">${rf.rec.toFixed(2)}</td>
                                        </tr>
                                        <tr style="height: 34px; background: #252525; border-bottom: 1px solid #333;">
                                            <td style="padding: 4px 8px;">F1-Score</td>
                                            <td style="padding: 4px 8px;">${svm.f1.toFixed(2)}</td>
                                            <td style="padding: 4px 8px; color: #66b3ff;">${rf.f1.toFixed(2)}</td>
                                        </tr>
                                        <tr style="height: 34px;">
                                            <td style="padding: 4px 8px;">AUC</td>
                                            <td style="padding: 4px 8px;">${svm.auc.toFixed(2)}</td>
                                            <td style="padding: 4px 8px; color: #66b3ff;">${rf.auc.toFixed(2)}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>`;
                    }
        
                    updateStatus(output);
                } else {
                    updateStatus('‚ùå ML Prediction failed: ' + data.error);
                }
            } catch (error) {
                updateStatus('‚ùå Error: ' + error.message);
            }

            showLoader(false);
        }

        function saveResult() {
            if (!resultImage) {
                updateStatus('‚ö†Ô∏è No result to save!');
                return;
            }

            const link = document.createElement('a');
            link.href = resultImage;
            link.download = 'fire_detection_result.png';
            link.click();
            updateStatus('üíæ Saved result image.');
        }

        function resetAll() {
            currentImage = null;
            resultImage = null;
            document.getElementById('originalImage').innerHTML = '<span style="color: #666;">No image loaded</span>';
            document.getElementById('resultImage').innerHTML = '<span style="color: #666;">No result yet</span>';
            document.getElementById('btnEnhance').disabled = true;
            document.getElementById('btnDetect').disabled = true;
            document.getElementById('btnSave').disabled = true;
            updateStatus('Status: Ready ‚Äî Load an image.');
        }

        function updateSensitivity() {
            const value = document.getElementById('sensitivity').value;
            console.log('Sensitivity:', value);
        }

        function updateStatus(message) {
            document.getElementById('statusBar').innerHTML = message;
        }

        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }
    </script>
    <div style="text-align: right; padding: 10px 20px; font-size: 12px; color: #666; font-family: sans-serif; margin-top: 20px;">
    &copy; A_Sam_Sarvesh. <br>  <br>
           Made with ‚ù§ in India.
    </div>
</body>
</html>








